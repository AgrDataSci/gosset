<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trait prioritization and crop performance with decentralized on-farm trial data • gosset</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Trait prioritization and crop performance with decentralized on-farm trial data">
<meta property="og:description" content="gosset">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gosset</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Overview.html">Trait prioritization and crop performance with decentralized on-farm trial data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/agrdatasci/gosset/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Overview_files/header-attrs-2.13/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Trait prioritization and crop performance with
decentralized on-farm trial data</h1>
                        <h4 class="author">Kauê de Sousa</h4>
            <address class="author_afil">
      Department of Agricultural Sciences, Inland Norway University,
Hamar, Norway  Digital Inclusion, Bioversity International,
Montpellier,
France<br><h4 class="author">David
Brown</h4>
            <address class="author_afil">
      Laboratory of Geo-Information Science and Remote Sensing,
Wageningen University &amp; Research, Wageningen, The Netherlands 
Digital Inclusion, Bioversity International, Turrialba, Costa
Rica<br><h4 class="author">Jacob van
Etten</h4>
            <address class="author_afil">
      Digital Inclusion, Bioversity International, Montpellier,
France<br><small class="dont-index">Source: <a href="https://github.com/agrdatasci/gosset/blob/master/vignettes/Overview.Rmd"><code>vignettes/Overview.Rmd</code></a></small>
      <div class="hidden name"><code>Overview.Rmd</code></div>

    </address>
</address>
</address>
</div>

    
    
<div id="summary" class="section level1">
<h1 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h1>
<p>The gosset package provides a set of tools and methods to implement a
workflow to analyse experimental agriculture data, from data synthesis
to model selection and visualisation. The package is named after W.S.
Gosset aka ‘Student’, a pioneer of modern statistics in small sample
experimental design and analysis.</p>
<p>In this example we show one of the possible workflows to assess trait
prioritization and crop performance using decentralized on-farm data
generated with the tricot approach <span class="citation">[1]</span>. We
use the <code>nicabean</code> data. This dataset was generated with
decentralized on-farm trials of common bean (<em>Phaseolus vulgaris</em>
L.) varieties in Nicaragua over five seasons (between 2015 and 2016).
Following the tricot approach <span class="citation">[1]</span>, farmers
were asked to test in their farms three varieties of common bean. The
varieties were randomly assigned as incomplete blocks of size three (out
of 10 varieties). The farmers assessed which of the three varieties had
the best and worst performance in eight traits (vigor, architecture,
resistance to pests, resistance to diseases, tolerance to drought,
yield, marketability, and taste). The farmers also provided their
overall appreciation about the varieties, i.e., which variety had the
best and the worst performance based on the overall performance
considering all the traits.</p>
<p>Here we use the Plackett-Luce model, jointly proposed by Luce (1959)
<span class="citation">[2]</span> and Plackett (1975) <span class="citation">[3]</span>. This model estimates the probability of one
variety outperforming all the others (worth) in the trait based on the
Luce’s axiom<span class="citation">[2]</span>. The model is implemented
in <code>R</code> by Turner et al. (2020) with the package
<code>PlackettLuce</code> <span class="citation">[4]</span>.</p>
<p>The <code>nicabean</code> is a list with two data frames. The first,
<code>trial</code>, contains the trial data with farmers’ evaluations,
ranked from 1 to 3, with 1 being the higher ranked variety and 3 the
lowest ranked variety for the given trait and incomplete block. The
rankings in this dataset were previously transformed from tricot
rankings (where participants indicate best and worst) to ordinal
rankings using the function <code><a href="../reference/rank_tricot.html">rank_tricot()</a></code>. The second data
frame, <code>covar</code>, contains the covariates associated to the
on-farm trial plots and farmers. This example will require the packages
PlackettLuce <span class="citation">[4]</span>, climatrends <span class="citation">[5]</span>, chirps <span class="citation">[6]</span>
and ggplot2 <span class="citation">[7]</span>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://agrdatasci.github.io/gosset/">"gosset"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://hturner.github.io/PlackettLuce/">"PlackettLuce"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://agrdatasci.github.io/climatrends/">"climatrends"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/chirps/">"chirps"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org">"ggplot2"</a></span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"nicabean"</span>, package <span class="op">=</span> <span class="st">"gosset"</span><span class="op">)</span>

<span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">nicabean</span><span class="op">$</span><span class="va">trial</span>

<span class="va">covar</span> <span class="op">&lt;-</span> <span class="va">nicabean</span><span class="op">$</span><span class="va">covar</span>

<span class="va">traits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">trait</span><span class="op">)</span>

<span class="va">dat</span></code></pre></div>
<pre><code>##           id            item               trait  rank
##        &lt;int&gt;           &lt;chr&gt;               &lt;chr&gt; &lt;int&gt;
## 1:      2110      Amadeus 77               Vigor     2
## 2:      2110      IBC 302-29               Vigor     3
## 3:      2110    INTA Ferroso               Vigor     1
## 4:      2110      Amadeus 77        Architecture     3
## 5:      2110      IBC 302-29        Architecture     2
## ---                                                   
## 15035:  3552 INTA Centro Sur               Taste     3
## 15036:  3552     BRT 103-182               Taste     2
## 15037:  3552      IBC 302-29 OverallAppreciation     2
## 15038:  3552 INTA Centro Sur OverallAppreciation     3
## 15039:  3552     BRT 103-182 OverallAppreciation     1</code></pre>
<p>To start the analysis of the data, we transform the ordinal rankings
into Plackett-Luce rankings (a sparse matrix) using the function
<code><a href="../reference/rank_numeric.html">rank_numeric()</a></code>. We run iteratively over the traits adding
the rankings to a list called <code>R</code>. Since the varieties are
ranked in an ascending order, with 1 being the higher ranked and 3 the
lower ranked, we use the argument <code>asceding = TRUE</code> to
indicate which order should be used.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">R</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">vector</a></span><span class="op">(</span>mode <span class="op">=</span> <span class="st">"list"</span>, length <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">traits</span><span class="op">)</span><span class="op">)</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_along</a></span><span class="op">(</span><span class="va">traits</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>

  <span class="va">dat_i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">dat</span>, <span class="va">dat</span><span class="op">$</span><span class="va">trait</span> <span class="op">==</span> <span class="va">traits</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span>

  <span class="va">R</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rank_numeric.html">rank_numeric</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat_i</span>,
                         items <span class="op">=</span> <span class="st">"item"</span>,
                         input <span class="op">=</span> <span class="st">"rank"</span>,
                         id <span class="op">=</span> <span class="st">"id"</span>,
                         ascending <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="the-multi-layers-of-farmers-overall-appreciation" class="section level1">
<h1 class="hasAnchor">
<a href="#the-multi-layers-of-farmers-overall-appreciation" class="anchor"></a>The multi-layers of farmers’ overall appreciation</h1>
<p>Using the function <code><a href="../reference/kendallTau.html">kendallTau()</a></code> we can compute the
Kendall tau (<span class="math inline">\(\tau\)</span>) coefficient
<span class="citation">[8]</span> to identify the correlation between
farmers’ overall appreciation and the other traits in the trial. This
approach can be used, for example, to assess the drivers of farmers
choices or to prioritize traits to be tested in a next stage of tricot
trials (e.g. a lite version of tricot with no more than 4 traits to
assess). We use the overall appreciation as the reference trait, and
compare the Kendall tau with the other 8 traits.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">baseline</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"OverallAppreciation"</span>, <span class="va">traits</span><span class="op">)</span><span class="op">)</span>

<span class="va">kendall</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">R</span><span class="op">[</span><span class="op">-</span><span class="va">baseline</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="../reference/kendallTau.html">kendallTau</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">R</span><span class="op">[[</span><span class="va">baseline</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="va">kendall</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="va">kendall</span><span class="op">)</span>

<span class="va">kendall</span><span class="op">$</span><span class="va">trait</span> <span class="op">&lt;-</span> <span class="va">traits</span><span class="op">[</span><span class="op">-</span><span class="va">baseline</span><span class="op">]</span></code></pre></div>
<p>The kendall correlation shows that farmers prioritized the traits
yield (<span class="math inline">\(\tau\)</span> = 0.749), taste (<span class="math inline">\(\tau\)</span> = 0.653) and marketability (<span class="math inline">\(\tau\)</span> = 0.639) when assessing overall
appreciation.</p>
<pre><code>##                   trait kendallTau
##                   &lt;chr&gt;      &lt;dbl&gt;
## 1:                Vigor      0.439
## 2:         Architecture      0.393
## 3:    ResistanceToPests      0.463
## 4: ResistanceToDiseases      0.449
## 5:   ToleranceToDrought      0.411
## 6:                Yield      0.749
## 7:        Marketability      0.639
## 8:                Taste      0.653</code></pre>
</div>
<div id="performance-of-varieties-across-traits" class="section level1">
<h1 class="hasAnchor">
<a href="#performance-of-varieties-across-traits" class="anchor"></a>Performance of varieties across traits</h1>
<p>For each trait, we fit a Plackett-Luce model using the function
<code><a href="https://hturner.github.io/PlackettLuce/reference/PlackettLuce.html">PlackettLuce()</a></code> from the package of the same name. This will
allow us to continue the analysis of the trial data using the other
functions in the package gosset.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">R</span>, <span class="va">PlackettLuce</span><span class="op">)</span></code></pre></div>
<p>The <code><a href="../reference/worth_map.html">worth_map()</a></code> function can be used to visually assess
and compare item performance based on different characteristics. The
values represented in a worth_map are log-worth estimates. From the
breeder or product developer perspective the function
<code><a href="../reference/worth_map.html">worth_map()</a></code> offers a visualization tool to help in
identifying item performance based on different characteristics and
select crossing materials.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/worth_map.html">worth_map</a></span><span class="op">(</span><span class="va">mod</span><span class="op">[</span><span class="op">-</span><span class="va">baseline</span><span class="op">]</span>,
          labels <span class="op">=</span> <span class="va">traits</span><span class="op">[</span><span class="op">-</span><span class="va">baseline</span><span class="op">]</span>,
          ref <span class="op">=</span> <span class="st">"Amadeus 77"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Variety"</span>,
       y <span class="op">=</span> <span class="st">"Trait"</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="Overview_files/figure-html/worthmap-1.png" alt="Trait performance (log-worth) of bean varieties in Niragua. Variety 'Amadeus' is set as reference (log-worth = 0). Blue values indicate a superior performance of varieties for a given trait, compared to the reference.  Red values indicate a variety with weak performance for the given trait, compared to the reference." width="700"><p class="caption">
Trait performance (log-worth) of bean varieties in Niragua. Variety
‘Amadeus’ is set as reference (log-worth = 0). Blue values indicate a
superior performance of varieties for a given trait, compared to the
reference. Red values indicate a variety with weak performance for the
given trait, compared to the reference.
</p>
</div>
</div>
<div id="the-effect-of-rainfall-on-yield" class="section level1">
<h1 class="hasAnchor">
<a href="#the-effect-of-rainfall-on-yield" class="anchor"></a>The effect of rainfall on yield</h1>
<p>To consider the effect of climate factors on yield, we use
agro-climatic covariates to fit a Plackett-Luce tree. For simplicity, we
use the total rainfall (Rtotal) derived from CHIRPS data <span class="citation">[9]</span>, obtained in R using the R package chirps
<span class="citation">[6]</span>. Additional covariates can be used in
a Plackett-Luce tree, for example using temperature data from R package
ag5Tools <span class="citation">[10]</span> or nasapower <span class="citation">[11]</span>.</p>
<p>We request the CHIRPS data using the package chirps. Data should be
returned as a matrix. This process can take some minutes to be
implemented.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">covar</span><span class="op">[</span>, <span class="st">"planting_date"</span><span class="op">]</span><span class="op">)</span>,
           <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">covar</span><span class="op">[</span>, <span class="st">"planting_date"</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fl">70</span><span class="op">)</span>

<span class="va">chirps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/chirps/reference/get_chirps.html">get_chirps</a></span><span class="op">(</span><span class="va">covar</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"longitude"</span>,<span class="st">"latitude"</span><span class="op">)</span><span class="op">]</span>, 
                     dates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">dates</span><span class="op">)</span>,
                     as.matrix <span class="op">=</span> <span class="cn">TRUE</span>,
                     server <span class="op">=</span> <span class="st">"ClimateSERV"</span><span class="op">)</span></code></pre></div>
<p>We compute the rainfall indices from planting date to the first 45
days of plant growth using the function <code><a href="https://agrdatasci.github.io/climatrends/reference/rainfall.html">rainfall()</a></code> from
package climatrends <span class="citation">[5]</span>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">chirps</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
<span class="va">newnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"chirps-v2.0."</span>, <span class="st">""</span>, <span class="va">newnames</span><span class="op">)</span>
<span class="va">newnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"[.]"</span>, <span class="st">"-"</span>, <span class="va">newnames</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/dimnames.html">dimnames</a></span><span class="op">(</span><span class="va">chirps</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">newnames</span>

<span class="va">rain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://agrdatasci.github.io/climatrends/reference/rainfall.html">rainfall</a></span><span class="op">(</span><span class="va">chirps</span>, day.one <span class="op">=</span> <span class="va">covar</span><span class="op">$</span><span class="va">planting_date</span>, span <span class="op">=</span> <span class="fl">45</span><span class="op">)</span></code></pre></div>
<p>To be linked to covariates, the rankings should be coerced to a
‘grouped_rankings’ object. For this we use the function
<code><a href="https://hturner.github.io/PlackettLuce/reference/group.html">group()</a></code> from PlackettLuce. We retain the ranking
corresponding to yield.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">yield</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"Yield"</span>, <span class="va">traits</span><span class="op">)</span><span class="op">)</span>

<span class="va">G</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hturner.github.io/PlackettLuce/reference/group.html">group</a></span><span class="op">(</span><span class="va">R</span><span class="op">[[</span><span class="va">yield</span><span class="op">]</span><span class="op">]</span>, index <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">R</span><span class="op">[[</span><span class="va">yield</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">G</span><span class="op">)</span></code></pre></div>
<pre><code>##                      1                      2                      3 
## "INTA Ferroso &gt; I ..." "BRT 103-182 &gt; IB ..." "INTA Ferroso &gt; I ..." 
##                      4                      5                      6 
## "BRT 103-182 &gt; IB ..." "BRT 103-182 &gt; IB ..." "BRT 103-182 &gt; AL ..."</code></pre>
<p>Now we can fit the Plackett-Luce tree with climate covariates.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pldG</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">G</span>, <span class="va">rain</span><span class="op">)</span>

<span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hturner.github.io/PlackettLuce/reference/pltree.html">pltree</a></span><span class="op">(</span><span class="va">G</span> <span class="op">~</span> <span class="va">Rtotal</span>, data <span class="op">=</span> <span class="va">pldG</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></code></pre></div>
<pre><code>## Plackett-Luce tree
## 
## Model formula:
## G ~ Rtotal
## 
## Fitted party:
## [1] root
## |   [2] Rtotal &lt;= 193.8153: n = 393
## |            ALS 0532-6      Amadeus 77     BRT 103-182      IBC 302-29 INTA Centro Sur 
## |             0.0000000       0.6269536       0.7018178       0.6510282       0.5419017 
## |          INTA Ferroso  INTA Matagalpa     INTA Precoz      SJC 730-79    SX 14825-7-1 
## |             0.3993557       0.3775061       0.3858863       0.4045355       0.6933340 
## |   [3] Rtotal &gt; 193.8153: n = 164
## |            ALS 0532-6      Amadeus 77     BRT 103-182      IBC 302-29 INTA Centro Sur 
## |             0.0000000      -0.5307674      -0.6414091      -0.9089877      -0.5821163 
## |          INTA Ferroso  INTA Matagalpa     INTA Precoz      SJC 730-79    SX 14825-7-1 
## |            -1.1910556      -0.6922428      -0.8152149      -0.5724198      -0.2688304 
## 
## Number of inner nodes:    1
## Number of terminal nodes: 2
## Number of parameters per node: 10
## Objective function (negative log-likelihood): 977.2531</code></pre>
<p>The following is an example of the plot made with the function
<code><a href="https://rdrr.io/r/graphics/plot.default.html">plot()</a></code> in the gosset package. The functions
<code><a href="../reference/node_labels.html">node_labels()</a></code>, <code><a href="../reference/node_labels.html">node_rules()</a></code> and
<code><a href="../reference/node_labels.html">top_items()</a></code> can be used to identify the splitting variables
in the tree, the rules used to split the tree and the best items in each
node, respectively.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/node_labels.html">node_labels</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "Rtotal"</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/node_labels.html">node_rules</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></code></pre></div>
<pre><code>##   node                      rules
## 1    2 Rtotal &lt;= 193.815301895142
## 2    3  Rtotal &gt; 193.815301895142</code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/node_labels.html">top_items</a></span><span class="op">(</span><span class="va">tree</span>, top <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></code></pre></div>
<pre><code>##          Node2        Node3
## 1  BRT 103-182   ALS 0532-6
## 2 SX 14825-7-1 SX 14825-7-1
## 3   IBC 302-29   Amadeus 77</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">tree</span>, ref <span class="op">=</span> <span class="st">"Amadeus 77"</span>, ci.level <span class="op">=</span> <span class="fl">0.9</span><span class="op">)</span></code></pre></div>
<p><img src="Overview_files/figure-html/node_info2-1.png" width="700"></p>
</div>
<div id="reliability-of-superior-genotypes" class="section level1">
<h1 class="hasAnchor">
<a href="#reliability-of-superior-genotypes" class="anchor"></a>Reliability of superior genotypes</h1>
<p>We can use the function <code><a href="../reference/reliability.html">reliability()</a></code> to compute the
reliability of the evaluated common bean varieties in each of the
resulting nodes of the Plackett-Luce tree (Table 3). This helps in
identifying the varieties with higher probability to outperform a
variety check (Amadeus 77) <span class="citation">[12]</span>. For
simplicity, we present only the varieties with reliability <span class="math inline">\(\geq\)</span> 0.5.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/reliability.html">reliability</a></span><span class="op">(</span><span class="va">tree</span>, ref <span class="op">=</span> <span class="st">"Amadeus 77"</span><span class="op">)</span></code></pre></div>
<pre><code>##      node         item reliability reliabilitySE worth
##     &lt;int&gt;        &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;
## 2:      2   Amadeus 77       0.500         0.035 0.114
## 3:      2  BRT 103-182       0.519         0.036 0.123
## 4:      2   IBC 302-29       0.506         0.035 0.117
## 10:     2 SX 14825-7-1       0.517         0.033 0.122
## 11:     3   ALS 0532-6       0.630         0.056 0.177
## 12:     3   Amadeus 77       0.500         0.058 0.104
## 20:     3 SX 14825-7-1       0.565         0.053 0.135</code></pre>
<p>The result shows that three varieties can marginally outperform
Amadeus 77 under drier growing conditions (Rtotal <span class="math inline">\(\leq\)</span> 193.82 mm) whereas two varieties
have a superior yield performance when under higher rainfall conditions
(Rtotal <span class="math inline">\(&gt;\)</span> 193.82 mm) compared to
the reference. This approach helps in identifying superior varieties for
different target population environments. For example, the variety ALS
0532-6 shows weak performance in the whole yield ranking, however for
the sub-group of higher rainfall, the variety outperforms all the
others. Combining rankings with socio-economic covariates could also
support the identification of superior materials for different market
segments.</p>
</div>
<div id="going-beyond-yield" class="section level1">
<h1 class="hasAnchor">
<a href="#going-beyond-yield" class="anchor"></a>Going beyond yield</h1>
<p>A better approach to assess the performance of varieties can be using
the ’Overall Appreciation”, since we expect this trait to capture the
performance of the variety not only for yield, but for all the other
traits prioritized by farmers (Table 2). To support this hypotheses, we
use the function <code><a href="../reference/compare.html">compare()</a></code> which applies the approach
proposed by Bland and Altman (1986) <span class="citation">[13]</span>
to assess the agreement between two different measures. We compare
overall vs yield. If both measures completely agree, all the varieties
should be centered to 0 in the axis Y.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Overall</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hturner.github.io/PlackettLuce/reference/PlackettLuce.html">PlackettLuce</a></span><span class="op">(</span><span class="va">R</span><span class="op">[[</span><span class="va">baseline</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="va">Yield</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://hturner.github.io/PlackettLuce/reference/PlackettLuce.html">PlackettLuce</a></span><span class="op">(</span><span class="va">R</span><span class="op">[[</span><span class="va">yield</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>

<span class="fu"><a href="../reference/compare.html">compare</a></span><span class="op">(</span><span class="va">Overall</span>, <span class="va">Yield</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Average log(worth)"</span>,
       y <span class="op">=</span> <span class="st">"Difference (Overall Appreciation - Yield)"</span><span class="op">)</span></code></pre></div>
<p><img src="Overview_files/figure-html/compare-1.png" width="50%"></p>
<p>The chart shows no complete agreement between overall appreciation
and yield. For example, variety SX 14825-7-1 shows superior performance
for overall appreciation when compared with yield. Looking at the
log-worth in the heat map of Figure 1, we can argue that the superior
performance of the given variety is also related to taste, marketability
and diseases resistance. This performance, however, was not captured
when assessing only yield.</p>
</div>
<div id="conclusion" class="section level1">
<h1 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h1>
<p>Here we presented a simple workflow to assess crop variety
performance and trait prioritization in decentralized on-farm trials
with the tricot approach. A more complex workflow will also utilize
other functions available in gosset, for example, a forward selection
combined with <code><a href="../reference/crossvalidation.html">crossvalidation()</a></code> to improve model
robustness, or model selection with <code><a href="../reference/btpermute.html">btpermute()</a></code> to consider
all possible permutations in Bradley-Terry models, or a risk analysis
using <code><a href="../reference/regret.html">regret()</a></code> to support the selection of varieties, or
using <code><a href="../reference/rank_numeric.html">rank_numeric()</a></code> to combine legacy data and deal with
heterogeneous data from different trials. All of these were previously
implemented and validated elsewhere <span class="citation">[14–18]</span>.</p>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references csl-bib-body">
<div id="ref-vanetten_beza_2019" class="csl-entry">
<div class="csl-left-margin">1. </div>
<div class="csl-right-inline">van
Etten, J.; Beza, E.; Calderer, L.; Van Duijvendijk, K.; Fadda, C.;
Fantahun, B.; Kidane, Y.G.; Van De Gevel, J.; Gupta, A.; Mengistu, D.K.;
et al. First Experiences with a Novel Farmer Citizen Science Approach:
Crowdsourcing Participatory Variety Selection Through on-Farm Triadic
Comparisons of Technologies (Tricot). <em>Experimental Agriculture</em>
<strong>2016</strong>, <em>55</em>, 275–296, doi:<a href="https://doi.org/10.1017/S0014479716000739">10.1017/S0014479716000739</a>.</div>
</div>
<div id="ref-luce_individual_1959" class="csl-entry">
<div class="csl-left-margin">2. </div>
<div class="csl-right-inline">Luce, R.D. <em><span>Individual Choice
Behavior</span></em>; Courier Corporation, 1959; p. 153;</div>
</div>
<div id="ref-Plackett" class="csl-entry">
<div class="csl-left-margin">3. </div>
<div class="csl-right-inline">Plackett, R.L. <span class="nocase">The
Analysis of Permutations</span>. <em>Journal of the Royal Statistical
Society. Series C (Applied Statistics)</em> <strong>1975</strong>,
<em>24</em>, 193–202.</div>
</div>
<div id="ref-Turner2020" class="csl-entry">
<div class="csl-left-margin">4. </div>
<div class="csl-right-inline">Turner, H.L.; van Etten, J.; Firth, D.;
Kosmidis, I. <span class="nocase">Modelling rankings in R: the
PlackettLuce package</span>. <em>Computational Statistics</em>
<strong>2020</strong>, doi:<a href="https://doi.org/10.1007/s00180-020-00959-3">10.1007/s00180-020-00959-3</a>.</div>
</div>
<div id="ref-climatrends" class="csl-entry">
<div class="csl-left-margin">5. </div>
<div class="csl-right-inline">de
Sousa, K.; van Etten, J.; Solberg, S.Ø. <em><a href="https://CRAN.R-project.org/package=climatrends"><span class="nocase">climatrends</span>: Climate Variability Indices for
Ecological Modelling</a></em>; 2020;</div>
</div>
<div id="ref-chirps" class="csl-entry">
<div class="csl-left-margin">6. </div>
<div class="csl-right-inline">de
Sousa, K.; Sparks, A.H.; Ashmall, W.; van Etten, J.; Solberg, S.Ø. <span class="nocase">chirps: API Client for the CHIRPS Precipitation Data in
R</span>. <em>The Journal of Open Source Software</em>
<strong>2020</strong>, <em>5</em>, 2419, doi:<a href="https://doi.org/10.21105/joss.02419">10.21105/joss.02419</a>.</div>
</div>
<div id="ref-ggplot2" class="csl-entry">
<div class="csl-left-margin">7. </div>
<div class="csl-right-inline">Wickham, H. <em><a href="https://ggplot2.tidyverse.org"><span class="nocase">ggplot2</span>: Elegant Graphics for Data
Analysis</a></em>; Springer-Verlag New York, 2016; ISBN
978-3-319-24277-4.</div>
</div>
<div id="ref-kendall_1938" class="csl-entry">
<div class="csl-left-margin">8. </div>
<div class="csl-right-inline">Kendall, M.G. <span class="nocase">A new
measure of rank correlation</span>. <em>Biometrika</em>
<strong>1938</strong>, <em>30</em>, 81–93, doi:<a href="https://doi.org/10.1093/biomet/30.1-2.81">10.1093/biomet/30.1-2.81</a>.</div>
</div>
<div id="ref-Funk2015" class="csl-entry">
<div class="csl-left-margin">9. </div>
<div class="csl-right-inline">Funk, C.; Peterson, P.; Landsfeld, M.;
Pedreros, D.; Verdin, J.; Shukla, S.; Husak, G.; Rowland, J.; Harrison,
L.; Hoell, A.; et al. <span class="nocase">The climate hazards infrared
precipitation with stations—a new environmental record for monitoring
extremes</span>. <em>Scientific Data</em> <strong>2015</strong>,
<em>2</em>, 150066, doi:<a href="https://doi.org/10.1038/sdata.2015.66">10.1038/sdata.2015.66</a>.</div>
</div>
<div id="ref-ag5tools" class="csl-entry">
<div class="csl-left-margin">10. </div>
<div class="csl-right-inline">Brown, D.; de Sousa, K. <em><a href="https://agrdatasci.github.io/ag5Tools/">ag5Tools: Toolbox for
Downloading and Extracting Copernicus AgERA5 Data</a></em>; 2022;</div>
</div>
<div id="ref-nasapower" class="csl-entry">
<div class="csl-left-margin">11. </div>
<div class="csl-right-inline">Sparks, A.H. Nasapower: A NASA POWER Global
Meteorology, Surface Solar Energy and Climatology Data Client for r.
<em>The Journal of Open Source Software</em> <strong>2018</strong>,
<em>3</em>, 1035, doi:<a href="https://doi.org/10.21105/joss.01035">10.21105/joss.01035</a>.</div>
</div>
<div id="ref-eskridge_1992" class="csl-entry">
<div class="csl-left-margin">12. </div>
<div class="csl-right-inline">Eskridge, K.M.; Mumm, R.F. Choosing Plant
Cultivars Based on the Probability of Outperforming a Check.
<em>Theoretical and Applied Genetics</em> <strong>1992</strong>,
<em>84</em>, 494–500, doi:<a href="https://doi.org/10.1007/BF00229512">10.1007/BF00229512</a>.</div>
</div>
<div id="ref-MartinBland1986" class="csl-entry">
<div class="csl-left-margin">13. </div>
<div class="csl-right-inline">Bland, J.M.; Altman, DouglasG. Statistical
Methods for Assessing Agreement Between Two Methods of Clinical
Measurement. <em>The Lancet</em> <strong>1986</strong>, <em>327</em>,
307–310, doi:<a href="https://doi.org/10.1016/s0140-6736(86)90837-8">10.1016/s0140-6736(86)90837-8</a>.</div>
</div>
<div id="ref-vanEtten2019" class="csl-entry">
<div class="csl-left-margin">14. </div>
<div class="csl-right-inline">van
Etten, J.; de Sousa, K.; Aguilar, A.; Barrios, M.; Coto, A.; Dell’Acqua,
M.; Fadda, C.; Gebrehawaryat, Y.; van de Gevel, J.; Gupta, A.; et al.
<span class="nocase">Crop variety management for climate adaptation
supported by citizen science</span>. <em>Proceedings of the National
Academy of Sciences</em> <strong>2019</strong>, <em>116</em>, 4194–4199,
doi:<a href="https://doi.org/10.1073/pnas.1813720116">10.1073/pnas.1813720116</a>.</div>
</div>
<div id="ref-Moyo_2021" class="csl-entry">
<div class="csl-left-margin">15. </div>
<div class="csl-right-inline">Moyo, M.; Ssali, R.; Namanda, S.; Nakitto, M.;
Dery, E.K.; Akansake, D.; Adjebeng-Danquah, J.; van Etten, J.; de Sousa,
K.; Lindqvist-Kreuze, H.; et al. <span class="nocase">Consumer
Preference Testing of Boiled Sweetpotato Using Crowdsourced Citizen
Science in Ghana and Uganda</span>. <em>Frontiers in Sustainable Food
Systems</em> <strong>2021</strong>, <em>5</em>, 6, doi:<a href="https://doi.org/10.3389/fsufs.2021.620363">10.3389/fsufs.2021.620363</a>.</div>
</div>
<div id="ref-deSousa2021" class="csl-entry">
<div class="csl-left-margin">16. </div>
<div class="csl-right-inline">de
Sousa, K.; van Etten, J.; Poland, J.; Fadda, C.; Jannink, J.-L.; Kidane,
Y.G.; Lakew, B.F.; Mengistu, D.K.; Pè, M.E.; Solberg, S.Ø.; et al.
Data-Driven Decentralized Breeding Increases Prediction Accuracy in a
Challenging Crop Production Environment. <em>Communications biology</em>
<strong>2021</strong>, <em>4</em>, 1–9.</div>
</div>
<div id="ref-Steinkemindata2019" class="csl-entry">
<div class="csl-left-margin">17. </div>
<div class="csl-right-inline">Steinke, J.; Achieng, J.O.; Hammond, J.;
Kebede, S.S.; Mengistu, D.K.; Mgimiloko, M.G.; Mohammed, J.N.; Musyoka,
J.; Sieber, S.; van de Gevel, J.; et al. <span class="nocase">Household-specific targeting of agricultural advice via
mobile phones: Feasibility of a minimum data approach for smallholder
context</span>. <em>Computers and Electronics in Agriculture</em>
<strong>2019</strong>, <em>162</em>, 991–1000, doi:<a href="https://doi.org/10.1016/j.compag.2019.05.026">10.1016/j.compag.2019.05.026</a>.</div>
</div>
<div id="ref-brownlegacydata" class="csl-entry">
<div class="csl-left-margin">18. </div>
<div class="csl-right-inline">Brown, D.; Carpentier, S.; de Bruin, S.; de
Sousa, K.; Machida, L.; van Etten, J. <a href="https://hdl.handle.net/10568/117614"><span class="nocase">Combining legacy data from heterogeneous crop trials to
identify genotype by environment interactions using model-based
recursive partitioning</span></a>. In Proceedings of the ASA/CSSA/SSSA
international annual meeting; Salt Lake City, USA, 2021.</div>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Kauê de Sousa, Jacob van Etten, David Brown, Jonathan Steinke.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
